<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>embedded_project_template: cdev::CDev Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">embedded_project_template
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>cdev</b></li><li class="navelem"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html">CDev</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pro-static-attribs">Static Protected Attributes</a> &#124;
<a href="../../dd/d89/classcdev_1_1CDev-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">cdev::CDev Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for cdev::CDev:</div>
<div class="dyncontent">
<div class="center"><img src="../../dc/d50/classcdev_1_1CDev__inherit__graph.png" border="0" usemap="#cdev_1_1CDev_inherit__map" alt="Inheritance graph"/></div>
<map name="cdev_1_1CDev_inherit__map" id="cdev_1_1CDev_inherit__map">
<area shape="rect" id="node2" href="../../de/da0/classuORB_1_1DeviceNode.html" title="uORB::DeviceNode" alt="" coords="5,80,144,107"/>
</map>
<center><span class="legend">[<a href="../../graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:acd46bce7814f428044c0258f8d0518ab"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#acd46bce7814f428044c0258f8d0518ab">CDev</a> (const char *devname)</td></tr>
<tr class="separator:acd46bce7814f428044c0258f8d0518ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23663da9547f16eaa68ee0adf568bd12"><td class="memItemLeft" align="right" valign="top"><a id="a23663da9547f16eaa68ee0adf568bd12"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>CDev</b> (const <a class="el" href="../../d3/dff/classcdev_1_1CDev.html">cdev::CDev</a> &amp;)=delete</td></tr>
<tr class="separator:a23663da9547f16eaa68ee0adf568bd12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd0afe1a56175f89627126c57f382a20"><td class="memItemLeft" align="right" valign="top"><a id="acd0afe1a56175f89627126c57f382a20"></a>
<a class="el" href="../../d3/dff/classcdev_1_1CDev.html">CDev</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>operator=</b> (const <a class="el" href="../../d3/dff/classcdev_1_1CDev.html">CDev</a> &amp;)=delete</td></tr>
<tr class="separator:acd0afe1a56175f89627126c57f382a20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37de4c22663367cb98ee75a66479c961"><td class="memItemLeft" align="right" valign="top"><a id="a37de4c22663367cb98ee75a66479c961"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>CDev</b> (<a class="el" href="../../d3/dff/classcdev_1_1CDev.html">CDev</a> &amp;&amp;)=delete</td></tr>
<tr class="separator:a37de4c22663367cb98ee75a66479c961"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa59b53a58372869bbe2f163bef0d5b74"><td class="memItemLeft" align="right" valign="top"><a id="aa59b53a58372869bbe2f163bef0d5b74"></a>
<a class="el" href="../../d3/dff/classcdev_1_1CDev.html">CDev</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>operator=</b> (<a class="el" href="../../d3/dff/classcdev_1_1CDev.html">CDev</a> &amp;&amp;)=delete</td></tr>
<tr class="separator:aa59b53a58372869bbe2f163bef0d5b74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09c11095ecdc3b1bfe7eb0e7d47ea954"><td class="memItemLeft" align="right" valign="top"><a id="a09c11095ecdc3b1bfe7eb0e7d47ea954"></a>
virtual int&#160;</td><td class="memItemRight" valign="bottom"><b>init</b> ()</td></tr>
<tr class="separator:a09c11095ecdc3b1bfe7eb0e7d47ea954"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac04b7ee91373c86545107e3467ba54c1"><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#ac04b7ee91373c86545107e3467ba54c1">open</a> (file *filep)</td></tr>
<tr class="separator:ac04b7ee91373c86545107e3467ba54c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9241755ab3abf102eea85dad1e3dc6c4"><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#a9241755ab3abf102eea85dad1e3dc6c4">close</a> (file *filep)</td></tr>
<tr class="separator:a9241755ab3abf102eea85dad1e3dc6c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b0db49c478b621333aff6bb3321d057"><td class="memItemLeft" align="right" valign="top">virtual ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#a1b0db49c478b621333aff6bb3321d057">read</a> (file *filep, char *buffer, size_t buflen)</td></tr>
<tr class="separator:a1b0db49c478b621333aff6bb3321d057"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54aff43049b22cea19f8cc31cb2a0fd0"><td class="memItemLeft" align="right" valign="top">virtual ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#a54aff43049b22cea19f8cc31cb2a0fd0">write</a> (file *filep, const char *buffer, size_t buflen)</td></tr>
<tr class="separator:a54aff43049b22cea19f8cc31cb2a0fd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a987dd32ef79c2bb4380fa021ce430de2"><td class="memItemLeft" align="right" valign="top">virtual off_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#a987dd32ef79c2bb4380fa021ce430de2">seek</a> (file *filep, off_t offset, int whence)</td></tr>
<tr class="separator:a987dd32ef79c2bb4380fa021ce430de2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87eb4d4b92a501de458736e8d24eec40"><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#a87eb4d4b92a501de458736e8d24eec40">ioctl</a> (file *filep, int cmd, unsigned long arg)</td></tr>
<tr class="separator:a87eb4d4b92a501de458736e8d24eec40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a219a565bb1842c62e0f45a7eeaaec0d3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#a219a565bb1842c62e0f45a7eeaaec0d3">poll</a> (file *filep, struct pollfd *fds, bool setup)</td></tr>
<tr class="separator:a219a565bb1842c62e0f45a7eeaaec0d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bc1072e967a90dfac04a1227f200f6f"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#a0bc1072e967a90dfac04a1227f200f6f">get_devname</a> () const</td></tr>
<tr class="separator:a0bc1072e967a90dfac04a1227f200f6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:abf40a822665b0889584268e8a4dfbef2"><td class="memItemLeft" align="right" valign="top">virtual pollevent_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#abf40a822665b0889584268e8a4dfbef2">poll_state</a> (file *filep)</td></tr>
<tr class="separator:abf40a822665b0889584268e8a4dfbef2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa23e0fac4d51f7b14db7a7e7dfa0ac06"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#aa23e0fac4d51f7b14db7a7e7dfa0ac06">poll_notify</a> (pollevent_t events)</td></tr>
<tr class="separator:aa23e0fac4d51f7b14db7a7e7dfa0ac06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada35d652d0f6d7257fffe4ead0fbb6dd"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#ada35d652d0f6d7257fffe4ead0fbb6dd">poll_notify_one</a> (struct pollfd *fds, pollevent_t events)</td></tr>
<tr class="separator:ada35d652d0f6d7257fffe4ead0fbb6dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89860de90cb8850c1ac71ec59764cf46"><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#a89860de90cb8850c1ac71ec59764cf46">open_first</a> (file *filep)</td></tr>
<tr class="separator:a89860de90cb8850c1ac71ec59764cf46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2fb43c7b0884dcbc6fbf1aa90d50a38"><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#ae2fb43c7b0884dcbc6fbf1aa90d50a38">close_last</a> (file *filep)</td></tr>
<tr class="separator:ae2fb43c7b0884dcbc6fbf1aa90d50a38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cdc695d86a00139e11b2d57974475b4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#a8cdc695d86a00139e11b2d57974475b4">register_class_devname</a> (const char *class_devname)</td></tr>
<tr class="separator:a8cdc695d86a00139e11b2d57974475b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84f73216813a23f91cd9414262484f3f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#a84f73216813a23f91cd9414262484f3f">unregister_class_devname</a> (const char *class_devname, unsigned class_instance)</td></tr>
<tr class="separator:a84f73216813a23f91cd9414262484f3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae676cccee31dd393ab681414a146d868"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#ae676cccee31dd393ab681414a146d868">lock</a> ()</td></tr>
<tr class="separator:ae676cccee31dd393ab681414a146d868"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af65273e0578b277deea057dc7d558e9d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#af65273e0578b277deea057dc7d558e9d">unlock</a> ()</td></tr>
<tr class="separator:af65273e0578b277deea057dc7d558e9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fe9c784053bc2b7748db1ec405ae83f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#a9fe9c784053bc2b7748db1ec405ae83f">unregister_driver_and_memory</a> ()</td></tr>
<tr class="separator:a9fe9c784053bc2b7748db1ec405ae83f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:aa9b327dcb42b1160c01417ad64cd8e2b"><td class="memItemLeft" align="right" valign="top">sem_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#aa9b327dcb42b1160c01417ad64cd8e2b">_lock</a></td></tr>
<tr class="separator:aa9b327dcb42b1160c01417ad64cd8e2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-static-attribs"></a>
Static Protected Attributes</h2></td></tr>
<tr class="memitem:acb99fb0026b3466f200feef27046d612"><td class="memItemLeft" align="right" valign="top">static const file_operations&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/classcdev_1_1CDev.html#acb99fb0026b3466f200feef27046d612">fops</a></td></tr>
<tr class="separator:acb99fb0026b3466f200feef27046d612"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Abstract class for any character device </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d32/CDev_8hpp_source.html#l00077">77</a> of file <a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="acd46bce7814f428044c0258f8d0518ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd46bce7814f428044c0258f8d0518ab">&#9670;&nbsp;</a></span>CDev()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">cdev::CDev::CDev </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>devname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Constructor</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Driver name </td></tr>
    <tr><td class="paramname">devname</td><td>Device node name </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d4/d22/CDev_8cpp_source.html#l00059">59</a> of file <a class="el" href="../../d4/d22/CDev_8cpp_source.html">CDev.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                              :</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    _devname(devname)</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;{</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">//PX4_DEBUG(&quot;CDev::CDev&quot;);</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">int</span> ret = sem_init(&amp;<a class="code" href="../../d3/dff/classcdev_1_1CDev.html#aa9b327dcb42b1160c01417ad64cd8e2b">_lock</a>, 0, 1);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">if</span> (ret != 0) {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="comment">//PX4_DEBUG(&quot;SEM INIT FAIL: ret %d&quot;, ret);</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;}</div><div class="ttc" id="classcdev_1_1CDev_html_aa9b327dcb42b1160c01417ad64cd8e2b"><div class="ttname"><a href="../../d3/dff/classcdev_1_1CDev.html#aa9b327dcb42b1160c01417ad64cd8e2b">cdev::CDev::_lock</a></div><div class="ttdeci">sem_t _lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d32/CDev_8hpp_source.html#l00290">CDev.hpp:290</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a9241755ab3abf102eea85dad1e3dc6c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9241755ab3abf102eea85dad1e3dc6c4">&#9670;&nbsp;</a></span>close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int cdev::CDev::close </td>
          <td>(</td>
          <td class="paramtype">file *&#160;</td>
          <td class="paramname"><em>filep</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Handle a close of the device.</p>
<p>This function is called for every close of the device. The default implementation maintains _open_count and returns OK as long as it is not zero.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filep</td><td>Pointer to the NuttX file structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OK if the close was successful, -errno otherwise. </dd></dl>

<p>Reimplemented in <a class="el" href="../../de/da0/classuORB_1_1DeviceNode.html#a80ebf695636c701d3378525b6d0e4148">uORB::DeviceNode</a>.</p>

<p class="definition">Definition at line <a class="el" href="../../d4/d22/CDev_8cpp_source.html#l00175">175</a> of file <a class="el" href="../../d4/d22/CDev_8cpp_source.html">CDev.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;{</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">//PX4_DEBUG(&quot;CDev::close&quot;);</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="../../d3/dff/classcdev_1_1CDev.html#ae676cccee31dd393ab681414a146d868">lock</a>();</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">if</span> (_open_count &gt; 0) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="comment">/* decrement the open count */</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        _open_count--;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="comment">/* callback cannot decline the close */</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordflow">if</span> (_open_count == 0) {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            ret = <a class="code" href="../../d3/dff/classcdev_1_1CDev.html#ae2fb43c7b0884dcbc6fbf1aa90d50a38">close_last</a>(filep);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        ret = -EBADF;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <a class="code" href="../../d3/dff/classcdev_1_1CDev.html#af65273e0578b277deea057dc7d558e9d">unlock</a>();</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div><div class="ttc" id="classcdev_1_1CDev_html_af65273e0578b277deea057dc7d558e9d"><div class="ttname"><a href="../../d3/dff/classcdev_1_1CDev.html#af65273e0578b277deea057dc7d558e9d">cdev::CDev::unlock</a></div><div class="ttdeci">void unlock()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d32/CDev_8hpp_source.html#l00288">CDev.hpp:288</a></div></div>
<div class="ttc" id="classcdev_1_1CDev_html_ae676cccee31dd393ab681414a146d868"><div class="ttname"><a href="../../d3/dff/classcdev_1_1CDev.html#ae676cccee31dd393ab681414a146d868">cdev::CDev::lock</a></div><div class="ttdeci">void lock()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d32/CDev_8hpp_source.html#l00283">CDev.hpp:283</a></div></div>
<div class="ttc" id="classcdev_1_1CDev_html_ae2fb43c7b0884dcbc6fbf1aa90d50a38"><div class="ttname"><a href="../../d3/dff/classcdev_1_1CDev.html#ae2fb43c7b0884dcbc6fbf1aa90d50a38">cdev::CDev::close_last</a></div><div class="ttdeci">virtual int close_last(file *filep)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d32/CDev_8hpp_source.html#l00253">CDev.hpp:253</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae2fb43c7b0884dcbc6fbf1aa90d50a38"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2fb43c7b0884dcbc6fbf1aa90d50a38">&#9670;&nbsp;</a></span>close_last()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual int cdev::CDev::close_last </td>
          <td>(</td>
          <td class="paramtype">file *&#160;</td>
          <td class="paramname"><em>filep</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Notification of the last close.</p>
<p>This function is called when the device open count transitions from one to zero. The driver lock is held for the duration of the call.</p>
<p>The default implementation returns OK.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filep</td><td>Pointer to the NuttX file structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OK if the open should return OK, -errno otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d4/d32/CDev_8hpp_source.html#l00253">253</a> of file <a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;{ <span class="keywordflow">return</span> 0; }</div></div><!-- fragment -->
</div>
</div>
<a id="a0bc1072e967a90dfac04a1227f200f6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bc1072e967a90dfac04a1227f200f6f">&#9670;&nbsp;</a></span>get_devname()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const char* cdev::CDev::get_devname </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the device name.</p>
<dl class="section return"><dt>Returns</dt><dd>the file system string of the device handle </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d4/d32/CDev_8hpp_source.html#l00188">188</a> of file <a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;{ <span class="keywordflow">return</span> _devname; }</div></div><!-- fragment -->
</div>
</div>
<a id="a87eb4d4b92a501de458736e8d24eec40"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87eb4d4b92a501de458736e8d24eec40">&#9670;&nbsp;</a></span>ioctl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual int cdev::CDev::ioctl </td>
          <td>(</td>
          <td class="paramtype">file *&#160;</td>
          <td class="paramname"><em>filep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>arg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Perform an ioctl operation on the device.</p>
<p>The default implementation returns -ENOTTY. Subclasses should call the default implementation for any command they do not handle themselves.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filep</td><td>Pointer to the NuttX file structure. </td></tr>
    <tr><td class="paramname">cmd</td><td>The ioctl command value. </td></tr>
    <tr><td class="paramname">arg</td><td>The ioctl argument value. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OK on success, or -errno otherwise. </dd></dl>

<p>Reimplemented in <a class="el" href="../../de/da0/classuORB_1_1DeviceNode.html#acad1520dfb19e9449546dad7a4129c26">uORB::DeviceNode</a>.</p>

<p class="definition">Definition at line <a class="el" href="../../d4/d32/CDev_8hpp_source.html#l00168">168</a> of file <a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;{ <span class="keywordflow">return</span> -ENOTTY; };</div></div><!-- fragment -->
</div>
</div>
<a id="ae676cccee31dd393ab681414a146d868"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae676cccee31dd393ab681414a146d868">&#9670;&nbsp;</a></span>lock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void cdev::CDev::lock </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Take the driver lock.</p>
<p>Each driver instance has its own lock/semaphore.</p>
<p>Note that we must loop as the wait may be interrupted by a signal.</p>
<p>Careful: <a class="el" href="../../d3/dff/classcdev_1_1CDev.html#ae676cccee31dd393ab681414a146d868">lock()</a> calls cannot be nested! </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d32/CDev_8hpp_source.html#l00283">283</a> of file <a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;{ <span class="keywordflow">do</span> {} <span class="keywordflow">while</span> (sem_wait(&amp;<a class="code" href="../../d3/dff/classcdev_1_1CDev.html#aa9b327dcb42b1160c01417ad64cd8e2b">_lock</a>) != 0); }</div><div class="ttc" id="classcdev_1_1CDev_html_aa9b327dcb42b1160c01417ad64cd8e2b"><div class="ttname"><a href="../../d3/dff/classcdev_1_1CDev.html#aa9b327dcb42b1160c01417ad64cd8e2b">cdev::CDev::_lock</a></div><div class="ttdeci">sem_t _lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d32/CDev_8hpp_source.html#l00290">CDev.hpp:290</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac04b7ee91373c86545107e3467ba54c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac04b7ee91373c86545107e3467ba54c1">&#9670;&nbsp;</a></span>open()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int cdev::CDev::open </td>
          <td>(</td>
          <td class="paramtype">file *&#160;</td>
          <td class="paramname"><em>filep</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Handle an open of the device.</p>
<p>This function is called for every open of the device. The default implementation maintains _open_count and always returns OK.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filep</td><td>Pointer to the NuttX file structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OK if the open is allowed, -errno otherwise. </dd></dl>

<p>Reimplemented in <a class="el" href="../../de/da0/classuORB_1_1DeviceNode.html#ae7f3782c9876a17b4aa6949440655f1f">uORB::DeviceNode</a>.</p>

<p class="definition">Definition at line <a class="el" href="../../d4/d22/CDev_8cpp_source.html#l00150">150</a> of file <a class="el" href="../../d4/d22/CDev_8cpp_source.html">CDev.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;{</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">//PX4_DEBUG(&quot;CDev::open&quot;);</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="../../d3/dff/classcdev_1_1CDev.html#ae676cccee31dd393ab681414a146d868">lock</a>();</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">/* increment the open count */</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    _open_count++;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (_open_count == 1) {</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="comment">/* first-open callback may decline the open */</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        ret = <a class="code" href="../../d3/dff/classcdev_1_1CDev.html#a89860de90cb8850c1ac71ec59764cf46">open_first</a>(filep);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="keywordflow">if</span> (ret != 0) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            _open_count--;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="../../d3/dff/classcdev_1_1CDev.html#af65273e0578b277deea057dc7d558e9d">unlock</a>();</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;}</div><div class="ttc" id="classcdev_1_1CDev_html_af65273e0578b277deea057dc7d558e9d"><div class="ttname"><a href="../../d3/dff/classcdev_1_1CDev.html#af65273e0578b277deea057dc7d558e9d">cdev::CDev::unlock</a></div><div class="ttdeci">void unlock()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d32/CDev_8hpp_source.html#l00288">CDev.hpp:288</a></div></div>
<div class="ttc" id="classcdev_1_1CDev_html_ae676cccee31dd393ab681414a146d868"><div class="ttname"><a href="../../d3/dff/classcdev_1_1CDev.html#ae676cccee31dd393ab681414a146d868">cdev::CDev::lock</a></div><div class="ttdeci">void lock()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d32/CDev_8hpp_source.html#l00283">CDev.hpp:283</a></div></div>
<div class="ttc" id="classcdev_1_1CDev_html_a89860de90cb8850c1ac71ec59764cf46"><div class="ttname"><a href="../../d3/dff/classcdev_1_1CDev.html#a89860de90cb8850c1ac71ec59764cf46">cdev::CDev::open_first</a></div><div class="ttdeci">virtual int open_first(file *filep)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d32/CDev_8hpp_source.html#l00240">CDev.hpp:240</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a89860de90cb8850c1ac71ec59764cf46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89860de90cb8850c1ac71ec59764cf46">&#9670;&nbsp;</a></span>open_first()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual int cdev::CDev::open_first </td>
          <td>(</td>
          <td class="paramtype">file *&#160;</td>
          <td class="paramname"><em>filep</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Notification of the first open.</p>
<p>This function is called when the device open count transitions from zero to one. The driver lock is held for the duration of the call.</p>
<p>The default implementation returns OK.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filep</td><td>Pointer to the NuttX file structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OK if the open should proceed, -errno otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d4/d32/CDev_8hpp_source.html#l00240">240</a> of file <a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;{ <span class="keywordflow">return</span> 0; }</div></div><!-- fragment -->
</div>
</div>
<a id="a219a565bb1842c62e0f45a7eeaaec0d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a219a565bb1842c62e0f45a7eeaaec0d3">&#9670;&nbsp;</a></span>poll()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cdev::CDev::poll </td>
          <td>(</td>
          <td class="paramtype">file *&#160;</td>
          <td class="paramname"><em>filep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct pollfd *&#160;</td>
          <td class="paramname"><em>fds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>setup</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Perform a poll setup/teardown operation.</p>
<p>This is handled internally and should not normally be overridden.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filep</td><td>Pointer to the internal file structure. </td></tr>
    <tr><td class="paramname">fds</td><td>Poll descriptor being waited on. </td></tr>
    <tr><td class="paramname">setup</td><td>True if this is establishing a request, false if it is being torn down. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OK on success, or -errno otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d4/d22/CDev_8cpp_source.html#l00201">201</a> of file <a class="el" href="../../d4/d22/CDev_8cpp_source.html">CDev.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;{</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">//PX4_DEBUG(&quot;CDev::Poll %s&quot;, setup ? &quot;setup&quot; : &quot;teardown&quot;);</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">if</span> (setup) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">         * Save the file pointer in the pollfd for the subclass&#39;</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">         * benefit.</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        fds-&gt;priv = (<span class="keywordtype">void</span> *)filep;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="comment">//PX4_DEBUG(&quot;CDev::poll: fds-&gt;priv = %p&quot;, filep);</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">         * Lock against poll_notify() and possibly other callers (protect _pollset).</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        </div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        ATOMIC_ENTER;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">         * Try to store the fds for later use and handle array resizing.</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">while</span> ((ret = store_poll_waiter(fds)) == -ENFILE) {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="comment">// No free slot found. Resize the pollset. This is expensive, but it&#39;s only needed initially.</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="keywordflow">if</span> (_max_pollwaiters &gt;= 256 / 2) { <span class="comment">//_max_pollwaiters is uint8_t</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                ret = -ENOMEM;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keyword">const</span> uint8_t new_count = _max_pollwaiters &gt; 0 ? _max_pollwaiters * 2 : 1;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            pollfd **prev_pollset = _pollset;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="comment">// malloc uses a semaphore, we need to call it enabled IRQ&#39;s</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            leave_critical_section(flags);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            pollfd **new_pollset = <span class="keyword">new</span> pollfd *[new_count];</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            flags = enter_critical_section();</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="keywordflow">if</span> (prev_pollset == _pollset) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="comment">// no one else updated the _pollset meanwhile, so we&#39;re good to go</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                <span class="keywordflow">if</span> (!new_pollset) {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                    ret = -ENOMEM;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                <span class="keywordflow">if</span> (_max_pollwaiters &gt; 0) {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                    memset(new_pollset + _max_pollwaiters, 0, <span class="keyword">sizeof</span>(pollfd *) * (new_count - _max_pollwaiters));</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                    memcpy(new_pollset, _pollset, <span class="keyword">sizeof</span>(pollfd *) * _max_pollwaiters);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                _pollset = new_pollset;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                _pollset[_max_pollwaiters] = fds;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                _max_pollwaiters = new_count;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                <span class="comment">// free the previous _pollset (we need to unlock here which is fine because we don&#39;t access _pollset anymore)</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                leave_critical_section(flags);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                <span class="keywordflow">if</span> (prev_pollset) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                    <span class="keyword">delete</span>[](prev_pollset);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                }</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                flags = enter_critical_section();</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                <span class="comment">// Success</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                ret = 0;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            leave_critical_section(flags);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="comment">// We have to retry</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="keyword">delete</span>[] new_pollset;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            flags = enter_critical_section();</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">if</span> (ret == 0) {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">             * Check to see whether we should send a poll notification</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">             * immediately.</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            fds-&gt;revents |= fds-&gt;events &amp; <a class="code" href="../../d3/dff/classcdev_1_1CDev.html#abf40a822665b0889584268e8a4dfbef2">poll_state</a>(filep);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="comment">/* yes? post the notification */</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <span class="keywordflow">if</span> (fds-&gt;revents != 0) {</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                sem_post(fds-&gt;sem);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        }</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        ATOMIC_LEAVE;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        ATOMIC_ENTER;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">         * Handle a teardown request.</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        ret = remove_poll_waiter(fds);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        ATOMIC_LEAVE;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;}</div><div class="ttc" id="classcdev_1_1CDev_html_abf40a822665b0889584268e8a4dfbef2"><div class="ttname"><a href="../../d3/dff/classcdev_1_1CDev.html#abf40a822665b0889584268e8a4dfbef2">cdev::CDev::poll_state</a></div><div class="ttdeci">virtual pollevent_t poll_state(file *filep)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d32/CDev_8hpp_source.html#l00209">CDev.hpp:209</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa23e0fac4d51f7b14db7a7e7dfa0ac06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa23e0fac4d51f7b14db7a7e7dfa0ac06">&#9670;&nbsp;</a></span>poll_notify()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void cdev::CDev::poll_notify </td>
          <td>(</td>
          <td class="paramtype">pollevent_t&#160;</td>
          <td class="paramname"><em>events</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Report new poll events.</p>
<p>This function should be called anytime the state of the device changes in a fashion that might be interesting to a poll waiter.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">events</td><td>The new event(s) being announced. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d4/d22/CDev_8cpp_source.html#l00319">319</a> of file <a class="el" href="../../d4/d22/CDev_8cpp_source.html">CDev.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;{</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">//PX4_DEBUG(&quot;CDev::poll_notify events = %0x&quot;, events);</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="comment">/* lock against poll() as well as other wakeups */</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    ATOMIC_ENTER;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; _max_pollwaiters; i++) {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">nullptr</span> != _pollset[i]) {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <a class="code" href="../../d3/dff/classcdev_1_1CDev.html#ada35d652d0f6d7257fffe4ead0fbb6dd">poll_notify_one</a>(_pollset[i], events);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        }</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    }</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    ATOMIC_LEAVE;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;}</div><div class="ttc" id="classcdev_1_1CDev_html_ada35d652d0f6d7257fffe4ead0fbb6dd"><div class="ttname"><a href="../../d3/dff/classcdev_1_1CDev.html#ada35d652d0f6d7257fffe4ead0fbb6dd">cdev::CDev::poll_notify_one</a></div><div class="ttdeci">virtual void poll_notify_one(struct pollfd *fds, pollevent_t events)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d22/CDev_8cpp_source.html#l00336">CDev.cpp:336</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ada35d652d0f6d7257fffe4ead0fbb6dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada35d652d0f6d7257fffe4ead0fbb6dd">&#9670;&nbsp;</a></span>poll_notify_one()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void cdev::CDev::poll_notify_one </td>
          <td>(</td>
          <td class="paramtype">struct pollfd *&#160;</td>
          <td class="paramname"><em>fds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pollevent_t&#160;</td>
          <td class="paramname"><em>events</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Internal implementation of poll_notify.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fds</td><td>A poll waiter to notify. </td></tr>
    <tr><td class="paramname">events</td><td>The event(s) to send to the waiter. </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="../../de/da0/classuORB_1_1DeviceNode.html#a77061c03defdcb3eedfc9cdc8b38c003">uORB::DeviceNode</a>.</p>

<p class="definition">Definition at line <a class="el" href="../../d4/d22/CDev_8cpp_source.html#l00336">336</a> of file <a class="el" href="../../d4/d22/CDev_8cpp_source.html">CDev.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;{</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">//PX4_DEBUG(&quot;CDev::poll_notify_one&quot;);</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">/* update the reported event set */</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    fds-&gt;revents |= fds-&gt;events &amp; events;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">//PX4_DEBUG(&quot; Events fds=%p %0x %0x %0x&quot;, fds, fds-&gt;revents, fds-&gt;events, events);</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">if</span> (fds-&gt;revents != 0) {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        sem_post(fds-&gt;sem);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="abf40a822665b0889584268e8a4dfbef2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf40a822665b0889584268e8a4dfbef2">&#9670;&nbsp;</a></span>poll_state()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual pollevent_t cdev::CDev::poll_state </td>
          <td>(</td>
          <td class="paramtype">file *&#160;</td>
          <td class="paramname"><em>filep</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Check the current state of the device for poll events from the perspective of the file.</p>
<p>This function is called by the default <a class="el" href="../../d3/dff/classcdev_1_1CDev.html#a219a565bb1842c62e0f45a7eeaaec0d3">poll()</a> implementation when a poll is set up to determine whether the poll should return immediately.</p>
<p>The default implementation returns no events.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filep</td><td>The file that's interested. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The current set of poll events. </dd></dl>

<p>Reimplemented in <a class="el" href="../../de/da0/classuORB_1_1DeviceNode.html#a3ac7d5c93e5fd480cd623fd421afa060">uORB::DeviceNode</a>.</p>

<p class="definition">Definition at line <a class="el" href="../../d4/d32/CDev_8hpp_source.html#l00209">209</a> of file <a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;{ <span class="keywordflow">return</span> 0; }</div></div><!-- fragment -->
</div>
</div>
<a id="a1b0db49c478b621333aff6bb3321d057"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b0db49c478b621333aff6bb3321d057">&#9670;&nbsp;</a></span>read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual ssize_t cdev::CDev::read </td>
          <td>(</td>
          <td class="paramtype">file *&#160;</td>
          <td class="paramname"><em>filep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>buflen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Perform a read from the device.</p>
<p>The default implementation returns -ENOSYS.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filep</td><td>Pointer to the NuttX file structure. </td></tr>
    <tr><td class="paramname">buffer</td><td>Pointer to the buffer into which data should be placed. </td></tr>
    <tr><td class="paramname">buflen</td><td>The number of bytes to be read. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of bytes read or -errno otherwise. </dd></dl>

<p>Reimplemented in <a class="el" href="../../de/da0/classuORB_1_1DeviceNode.html#ada5db18aae221ae76e023651cbf9461c">uORB::DeviceNode</a>.</p>

<p class="definition">Definition at line <a class="el" href="../../d4/d32/CDev_8hpp_source.html#l00130">130</a> of file <a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;{ <span class="keywordflow">return</span> -ENOSYS; }</div></div><!-- fragment -->
</div>
</div>
<a id="a8cdc695d86a00139e11b2d57974475b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cdc695d86a00139e11b2d57974475b4">&#9670;&nbsp;</a></span>register_class_devname()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int cdev::CDev::register_class_devname </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>class_devname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Register a class device name, automatically adding device class instance suffix if need be.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">class_devname</td><td>Device class name </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>class_instamce Class instance created, or -errno on failure </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d4/d22/CDev_8cpp_source.html#l00087">87</a> of file <a class="el" href="../../d4/d22/CDev_8cpp_source.html">CDev.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">//PX4_DEBUG(&quot;CDev::register_class_devname %s&quot;, class_devname);</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> (class_devname == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordtype">int</span> class_instance = 0;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordtype">int</span> ret = -ENOSPC;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">while</span> (class_instance &lt; 4) {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="keywordtype">char</span> name[32];</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        snprintf(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;%s%d&quot;</span>, class_devname, class_instance);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        ret = register_driver(name, &amp;<a class="code" href="../../d3/dff/classcdev_1_1CDev.html#acb99fb0026b3466f200feef27046d612">fops</a>, 0666, (<span class="keywordtype">void</span> *)<span class="keyword">this</span>);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordflow">if</span> (ret == 0) {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        class_instance++;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">if</span> (class_instance == 4) {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    }</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">return</span> class_instance;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;}</div><div class="ttc" id="classcdev_1_1CDev_html_acb99fb0026b3466f200feef27046d612"><div class="ttname"><a href="../../d3/dff/classcdev_1_1CDev.html#acb99fb0026b3466f200feef27046d612">cdev::CDev::fops</a></div><div class="ttdeci">static const file_operations fops</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d32/CDev_8hpp_source.html#l00195">CDev.hpp:195</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a987dd32ef79c2bb4380fa021ce430de2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a987dd32ef79c2bb4380fa021ce430de2">&#9670;&nbsp;</a></span>seek()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual off_t cdev::CDev::seek </td>
          <td>(</td>
          <td class="paramtype">file *&#160;</td>
          <td class="paramname"><em>filep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">off_t&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>whence</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Perform a logical seek operation on the device.</p>
<p>The default implementation returns -ENOSYS.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filep</td><td>Pointer to the NuttX file structure. </td></tr>
    <tr><td class="paramname">offset</td><td>The new file position relative to whence. </td></tr>
    <tr><td class="paramname">whence</td><td>SEEK_OFS, SEEK_CUR or SEEK_END. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The previous offset, or -errno otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d4/d32/CDev_8hpp_source.html#l00154">154</a> of file <a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;{ <span class="keywordflow">return</span> -ENOSYS; }</div></div><!-- fragment -->
</div>
</div>
<a id="af65273e0578b277deea057dc7d558e9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af65273e0578b277deea057dc7d558e9d">&#9670;&nbsp;</a></span>unlock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void cdev::CDev::unlock </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Release the driver lock. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d32/CDev_8hpp_source.html#l00288">288</a> of file <a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;{ sem_post(&amp;<a class="code" href="../../d3/dff/classcdev_1_1CDev.html#aa9b327dcb42b1160c01417ad64cd8e2b">_lock</a>); }</div><div class="ttc" id="classcdev_1_1CDev_html_aa9b327dcb42b1160c01417ad64cd8e2b"><div class="ttname"><a href="../../d3/dff/classcdev_1_1CDev.html#aa9b327dcb42b1160c01417ad64cd8e2b">cdev::CDev::_lock</a></div><div class="ttdeci">sem_t _lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d32/CDev_8hpp_source.html#l00290">CDev.hpp:290</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a84f73216813a23f91cd9414262484f3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84f73216813a23f91cd9414262484f3f">&#9670;&nbsp;</a></span>unregister_class_devname()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int cdev::CDev::unregister_class_devname </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>class_devname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>class_instance</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Register a class device name, automatically adding device class instance suffix if need be.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">class_devname</td><td>Device class name </td></tr>
    <tr><td class="paramname">class_instance</td><td>Device class instance from <a class="el" href="../../d3/dff/classcdev_1_1CDev.html#a8cdc695d86a00139e11b2d57974475b4">register_class_devname()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OK on success, -errno otherwise </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d4/d22/CDev_8cpp_source.html#l00118">118</a> of file <a class="el" href="../../d4/d22/CDev_8cpp_source.html">CDev.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;{</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">//PX4_DEBUG(&quot;CDev::unregister_class_devname&quot;);</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordtype">char</span> name[32];</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    snprintf(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;%s%u&quot;</span>, class_devname, class_instance);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">return</span> unregister_driver(name);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a9fe9c784053bc2b7748db1ec405ae83f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fe9c784053bc2b7748db1ec405ae83f">&#9670;&nbsp;</a></span>unregister_driver_and_memory()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int cdev::CDev::unregister_driver_and_memory </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>First, unregisters the driver. Next, free the memory for the devname, in case it was expected to have ownership. Sets devname to nullptr.</p>
<p>This is only needed if the ownership of the devname was passed to the <a class="el" href="../../d3/dff/classcdev_1_1CDev.html">CDev</a>, otherwise ~CDev handles it.</p>
<dl class="section return"><dt>Returns</dt><dd>PX4_OK on success, -ENODEV if the devname is already nullptr </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d4/d22/CDev_8cpp_source.html#l00387">387</a> of file <a class="el" href="../../d4/d22/CDev_8cpp_source.html">CDev.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;{</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordtype">int</span> retval = 0;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">if</span> (_registered) {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        unregister_driver(_devname);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        _registered = <span class="keyword">false</span>;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        retval = -ENODEV;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">if</span> (_devname != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        free((<span class="keywordtype">void</span> *)_devname);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        _devname = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        retval = -ENODEV;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    }</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordflow">return</span> retval;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a54aff43049b22cea19f8cc31cb2a0fd0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54aff43049b22cea19f8cc31cb2a0fd0">&#9670;&nbsp;</a></span>write()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual ssize_t cdev::CDev::write </td>
          <td>(</td>
          <td class="paramtype">file *&#160;</td>
          <td class="paramname"><em>filep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>buflen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Perform a write to the device.</p>
<p>The default implementation returns -ENOSYS.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filep</td><td>Pointer to the NuttX file structure. </td></tr>
    <tr><td class="paramname">buffer</td><td>Pointer to the buffer from which data should be read. </td></tr>
    <tr><td class="paramname">buflen</td><td>The number of bytes to be written. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of bytes written or -errno otherwise. </dd></dl>

<p>Reimplemented in <a class="el" href="../../de/da0/classuORB_1_1DeviceNode.html#ab58b8b4b6cac9fd8aa4d90a85e044c78">uORB::DeviceNode</a>.</p>

<p class="definition">Definition at line <a class="el" href="../../d4/d32/CDev_8hpp_source.html#l00142">142</a> of file <a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;{ <span class="keywordflow">return</span> -ENOSYS; }</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="aa9b327dcb42b1160c01417ad64cd8e2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9b327dcb42b1160c01417ad64cd8e2b">&#9670;&nbsp;</a></span>_lock</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">sem_t cdev::CDev::_lock</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>lock to protect access to all class members (also for derived classes) </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d32/CDev_8hpp_source.html#l00290">290</a> of file <a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>.</p>

</div>
</div>
<a id="acb99fb0026b3466f200feef27046d612"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb99fb0026b3466f200feef27046d612">&#9670;&nbsp;</a></span>fops</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const file_operations cdev::CDev::fops</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Pointer to the default cdev file operations table; useful for registering clone devices etc. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d32/CDev_8hpp_source.html#l00195">195</a> of file <a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/andressanchez/Escritorio/GIT/project_template/src/lib/cdev/<a class="el" href="../../d4/d32/CDev_8hpp_source.html">CDev.hpp</a></li>
<li>/home/andressanchez/Escritorio/GIT/project_template/src/lib/cdev/<a class="el" href="../../d4/d22/CDev_8cpp_source.html">CDev.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
